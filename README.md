# hhplus-tdd-3week

시나리오 선정 및 프로젝트 Milestone 제출

# 시나리오 선정 
  - 콘서트 예약 서비스

# Milestone
## 1주차(설계 및 초기 준비)
  - 1일차<br/>
    ✔ 전체 요구사항 분석 및 아키텍처 설계
    
  - 2일차<br/>
    ✔ 플로우 차트 작성
    
  - 3일차<br/>
    ✔ API 명세서 작성 (각 API의 요청/응답 형식)
    
  - 4~5일차<br/>
    ✔ ERD, 시퀀스 다이어그램, API 플로우 차트 등 문서화 완료

## 2주차(주요 기능 개발 - 대기열 시스템, 예약 가능 조회)
  - 1-2일차<br/>
    ✔ 사용자 토큰 발급 API 개발 시작 (대기열 시스템 포함)<br/>
    ✔ 사용자별 대기열 상태를 확인할 수 있는 폴링 API 개발<br/>
    ✔ 단위 테스트 작성하여 대기열 생성 및 관리 기능 검증
    
  - 3-4일차<br/>
    ✔ 예약 가능 날짜 조회 API와 예약 가능 좌석 조회 API 구현<br/>
    ✔ 날짜와 좌석 번호를 확인하는 기능 개발, 좌석 가용성 조회 API 구축<br/>
    ✔ 좌석 가용성 확인에 대한 단위 테스트 작성
    
  - 5일차<br/>
    ✔ 대기열 시스템과 예약 가능 조회 API 통합 테스트<br/>
    ✔ 각 API가 대기열 보호 기능을 통해 안전하게 호출되는지 점검<br/>
    ✔ 코드 검토 및 개선, 테스트 보강

## 3주차(잔액 및 결제 시스템 개발)
  - 1-2일차<br/>
    ✔ 잔액 충전 및 조회 API 개발<br/>
    ✔ 사용자 식별자를 통해 잔액을 충전하고 조회하는 기능 추가<br/>
    ✔ 단위 테스트 작성, 잔액 관리 기능 정상 동작 여부 확인
    
  - 3-4일차<br/>
    ✔ 결제 API 개발, 좌석 예약 요청에 대해 결제를 완료하면 좌석 소유권 배정<br/>
    ✔ 결제 API는 예약된 좌석에 대해 잠금 해제 기능 추가<br/>
    ✔ 결제 워크플로우 검증을 위한 단위 테스트 작성 (결제 실패 시나리오 포함)
    
  - 5일차<br/>
    ✔ 예약과 결제 시스템 통합 테스트, 좌석 소유권 배정과 대기열 시스템 연동<br/>
    ✔ 결제 완료 시 대기열 토큰 만료, 잔액 차감 등 최종 검증<br/>
    ✔ 코드 최적화 및 성능 테스트 진행, 문서 업데이트

# 콘서트 예약 서비스 요구사항 분석

## 1. 유저 토큰 발급 API 및 대기열 시스템
### 요구 사항
- 각 사용자가 고유한 대기열 토큰을 받아 **순차적**으로 서비스에 접근할 수 있도록 하여, **혼잡 방지** 및 **공정한 접근**을 보장.

### 요구 기능
- 사용자가 요청하면 *토큰*을 발급받아 **대기열에 추가**됩니다.
- 토큰에는 대기 **순서**와 **예상 대기 시간**이 포함되며, 현재 상태를 확인할 수 있는 **폴링 API**도 제공합니다.
- 발급된 토큰을 통해 사용자는 **예약 서비스에 접근**할 수 있습니다.

### 개발 시 고려 사항
- *동시성 문제*를 해결하여 많은 사용자 요청에도 대기열이 잘 관리되도록 해야 합니다.
- 대기열 순서가 **정확하게 유지**되도록 설계하고, 특히 **분산 환경**에서도 일관성을 보장해야 합니다.
- 폴링 빈도를 조절하여 **서버 과부하를 방지**합니다.

---

## 2. 예약 가능 날짜 및 좌석 조회 API
### 요구 사항
- 사용자가 예약 가능한 날짜와 좌석을 미리 확인하여 **예약 결정을 쉽게 할 수 있도록** 합니다.

### 요구 기능
- 예약 가능한 **날짜**와 **좌석 정보**를 제공하는 API입니다.
- 좌석 번호는 *1번부터 50번까지* 관리되며, **예약 가능한 좌석**만 조회됩니다.

### 개발 시 고려 사항
- 날짜와 좌석 상태는 **실시간으로 업데이트**되어 최신 상태를 반영해야 합니다.
- 여러 사용자가 동시에 조회해도 **일관성 있는 좌석 정보**가 유지되도록 해야 합니다.
- 특정 좌석이 **예약되거나 취소될 때 즉각적으로 데이터 업데이트**가 필요합니다.

---

## 3. 좌석 예약 요청 API
### 요구 사항
- 사용자가 선택한 좌석을 일정 시간 동안 **임시로 잠그고, 예약할 수 있도록** 합니다.

### 요구 기능
- 사용자가 좌석 예약 요청을 하면, 좌석이 일정 시간 동안 **임시로 잠금**됩니다.
- 이 시간 동안은 다른 사용자가 해당 좌석을 **예약할 수 없도록** 하며, 결제 완료 시에만 **최종 확정**됩니다.

### 개발 시 고려 사항
- 예약 후 결제가 일정 시간 내에 이루어지지 않으면 **자동으로 잠금이 해제**되도록 합니다.
- 중복 예약을 방지하기 위해 여러 사용자가 동시에 접근해도 **일관성 있게 처리**해야 합니다.
- 잠금 상태 관리를 위해 *DB* 를 활용 합니다.

---

## 4. 잔액 충전 및 조회 API
### 요구 사항
- 사용자가 미리 예약과 결제를 위해 **잔액을 충전하고**, 필요 시 **잔액을 조회**할 수 있도록 합니다.

### 요구 기능
- **잔액을 충전**하고, 현재 **잔액 상태를 조회**하는 API를 제공합니다.
- 잔액 충전 내역을 기록하여, **사용 내역 추적**이 가능합니다.

### 개발 시 고려 사항
- 정확한 금액 충전을 위해 **입력 데이터 유효성 검증**이 필요합니다.
- 충전 및 소비 내역이 정확하게 반영되도록 **트랜잭션 처리**를 신경 써야 합니다.
- 분산 환경에서도 **데이터 동기화**가 잘 유지되도록 설계해야 합니다.

---

## 5. 결제 API
### 요구 사항
- 좌석 예약에 대해 **최종 결제를 완료**하여 **소유권을 확정**합니다.

### 요구 기능
- 결제 요청이 완료되면, 좌석 **소유권**이 사용자에게 배정되고, 토큰이 만료됩니다.
- 결제 실패 시에는 좌석 **잠금을 해제**하여 다른 사용자가 접근할 수 있도록 합니다.

### 개발 시 고려 사항
- 결제를 실시간으로 처리하면서도, 모든 **트랜잭션의 일관성**을 유지해야 합니다.
- 중복 결제를 방지합니다.

---

# 콘서트 예약 서비스 시퀀스 다이어그램

## 1. 유저 토큰 발급 API 요청 및 대기열 시스템
![image](https://github.com/user-attachments/assets/8ec6c228-f27b-43d5-b54a-bc136f4788c0)

---

## 2. 예약 가능 날짜 / 좌석 API 요청
![image](https://github.com/user-attachments/assets/e77f6756-e0c5-48d8-ab8e-cd02d507357f)

---

## 3. 좌석 예약 API 요청
![image](https://github.com/user-attachments/assets/cbb8f61e-d735-47a6-a94e-646a0bb69151)

---



